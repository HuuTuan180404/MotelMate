<!-- Header with Title and Search -->
<div class="header-container">
  <h2 class="page-title">INVOICE</h2>
  <div class="search-container">
    <!-- Clear All button -->
    <button mat-icon-button (click)="clearAllFilters()" matTooltip="Clear Filters">
      <mat-icon>close</mat-icon>
    </button>
    <!-- Export button -->
    <button *ngIf="role === 'owner'" mat-icon-button (click)="exportInvoices()" matTooltip="Export to csv">
      <mat-icon>file_upload</mat-icon>
    </button>
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search</mat-label>
      <input
        matInput
        placeholder="Search..."
        [(ngModel)]="searchTerm"
        (input)="applyFilters()"
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
    <button *ngIf="role === 'owner'" mat-flat-button class="create-btn" (click)="openCreateForm()" matTooltip="Create Invoice">
      <mat-icon>add</mat-icon> Create
    </button>
  </div>
</div>

<!-- Table Container -->
<div class="table-container">
  <!-- Filters Row -->
  <div class="filters-row">
    <!-- <div class="filter-label">Filter</div> -->
    <div class="filters-container">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-select [(ngModel)]="filters.building" (selectionChange)="applyFilters()" placeholder="Building">
          <mat-option value="">All Buildings</mat-option>
          <mat-option *ngFor="let b of buildings" [value]="b.name">
            {{ b.name }}
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>apartment</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-select [(ngModel)]="filters.status" (selectionChange)="applyFilters()" placeholder="Status">
          <mat-option value="">Status</mat-option>
          <mat-option *ngFor="let s of statuses" [value]="s">{{ s }}</mat-option>
        </mat-select>
        <mat-icon matSuffix>info</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Enter a date range</mat-label>
        <mat-date-range-input [rangePicker]="picker">
          <input matStartDate placeholder="Start date" [(ngModel)]="filters.startDate" (dateChange)="applyFilters()">
          <input matEndDate placeholder="End date" [(ngModel)]="filters.endDate" (dateChange)="applyFilters()">
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>
    </div>
  </div>

  <!-- Table with sort -->
  <table mat-table [dataSource]="dataSource" matSort class="contracts-table">
    <ng-container matColumnDef="building">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Building </th>
      <td mat-cell *matCellDef="let inv"> {{inv.building}} </td>
    </ng-container>

    <ng-container matColumnDef="room">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Room </th>
      <td mat-cell *matCellDef="let inv"> {{inv.room}} </td>
    </ng-container>

    <ng-container matColumnDef="month">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Month </th>
      <td mat-cell *matCellDef="let inv"> {{inv.month}} </td>
    </ng-container>

    <ng-container matColumnDef="due">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Due Date </th>
      <td mat-cell *matCellDef="let inv"> {{inv.due}} </td>
    </ng-container>

    <ng-container matColumnDef="total">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Total Amount (VND) </th>
      <td mat-cell *matCellDef="let inv"> {{inv.total | number}} </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef> Status </th>
      <td mat-cell *matCellDef="let inv">
        <span [ngClass]="'status ' + inv.status.toLowerCase()">{{ inv.status }}</span>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
        (click)="openInvoiceDetail(row)"
      style="cursor: pointer;"></tr>
  </table>

  <!-- Default Angular Material Paginator -->
  <mat-paginator [pageSizeOptions]="[5, 10, 15, 20]" showFirstLastButtons></mat-paginator>
</div>
