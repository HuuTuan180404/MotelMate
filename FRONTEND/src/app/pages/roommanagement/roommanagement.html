<div class="room-management-container">
  <!-- Header with Stats -->
  <mat-card class="header-card">
    <mat-card-header>
      <mat-icon>home</mat-icon>
      <h2>Room Management</h2>
    </mat-card-header>

    <mat-card-content>
      <div class="stats-grid">
        <mat-card class="stat-card total">
          <mat-card-content>
            <div class="stat-content">
              <mat-icon>home_work</mat-icon>
              <div class="stat-info">
                <div class="stat-number">{{ getRoomStats().total }}</div>
                <div class="stat-label">Total</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card available">
          <mat-card-content>
            <div class="stat-content">
              <mat-icon>check_circle</mat-icon>
              <div class="stat-info">
                <div class="stat-number">{{ getRoomStats().available }}</div>
                <div class="stat-label">AVAILABLE</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card occupied">
          <mat-card-content>
            <div class="stat-content">
              <mat-icon>person</mat-icon>
              <div class="stat-info">
                <div class="stat-number">{{ getRoomStats().occupied }}</div>
                <div class="stat-label">OCCUPIED</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card maintain">
          <mat-card-content>
            <div class="stat-content">
              <mat-icon>build</mat-icon>
              <div class="stat-info">
                <div class="stat-number">{{ getRoomStats().maintain }}</div>
                <div class="stat-label">MAINTENANCE</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>filter_list</mat-icon>
        Filter
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="filters-grid">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Tìm kiếm</mat-label>
          <input
            matInput
            [(ngModel)]="searchTerm"
            (input)="onSearchChange()"
            placeholder="Tìm theo số phòng hoặc tòa nhà..."
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Trạng thái</mat-label>
          <mat-select
            [(ngModel)]="selectedStatus"
            (selectionChange)="onStatusChange()"
          >
            <mat-option
              *ngFor="let option of statusOptions"
              [value]="option.value"
            >
              <mat-icon>{{ option.icon }}</mat-icon>
              {{ option.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Tòa nhà</mat-label>
          <mat-select
            [(ngModel)]="selectedBuilding"
            (selectionChange)="onBuildingChange()"
          >
            <mat-option
              *ngFor="let building of buildings"
              [value]="building.value"
            >
              {{ building.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button color="accent" (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Xóa bộ lọc
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Đang tải dữ liệu...</p>
  </div>

  <!-- Room Grid -->
  <div *ngIf="!isLoading" class="room-grid">
    <mat-card
      *ngFor="let room of filteredRooms"
      class="room-card"
      [class]="'status-' + room.status"
    >
      <!-- Room Image -->
      <div class="room-image-container">
        <img
          aria-label="room image"
          mat-card-image
          [src]="room.urlImage"
          [alt]="'Phòng ' + room.roomNumber"
        />
        <mat-chip-set class="status-chip-container">
          <mat-chip [color]="getStatusColor(room.status)" selected>
            <mat-icon matChipAvatar>{{ getStatusIcon(room.status) }}</mat-icon>
            {{ getStatusText(room.status) }}
          </mat-chip>
        </mat-chip-set>
      </div>

      <!-- Room Content -->
      <mat-card-header>
        <mat-card-title>
          <mat-icon>meeting_room</mat-icon>
          Phòng {{ room.roomNumber }}
        </mat-card-title>
        <mat-card-subtitle>
          <mat-icon>business</mat-icon>
          {{ room.buildingName }}
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="room-price">
          <mat-icon>attach_money</mat-icon>
          <span>{{ formatPrice(room.price) }}/tháng</span>
        </div>

        <!-- Avatars -->
        <div class="avatars-section" *ngIf="room.urlAvatars.length > 0">
          <div class="avatars-header">
            <mat-icon>people</mat-icon>
            <span>Người thuê ({{ room.urlAvatars.length }})</span>
          </div>
          <div class="avatars-list">
            <img
              aria-label="avatar"
              *ngFor="let avatar of room.urlAvatars; let i = index"
              [src]="avatar"
              [alt]="'Người thuê ' + (i + 1)"
              class="avatar"
              [matTooltip]="'Người thuê ' + (i + 1)"
            />
          </div>
        </div>

        <div
          class="empty-avatars"
          *ngIf="room.urlAvatars.length === 0 && room.status === 'occupied'"
        >
          <mat-icon>person_outline</mat-icon>
          <span>Chưa có thông tin người thuê</span>
        </div>
      </mat-card-content>

      <!-- Room Actions -->
      <mat-card-actions>
        <mat-form-field appearance="fill" class="status-select">
          <mat-label>Cập nhật trạng thái</mat-label>
          <mat-select [value]="room.status">
            <!-- (selectionChange)="updateRoomStatus(room, $event.value)" -->
            <mat-option value="available">
              <mat-icon>check_circle</mat-icon>
              Có sẵn
            </mat-option>
            <mat-option value="occupied">
              <mat-icon>person</mat-icon>
              Đã thuê
            </mat-option>
            <mat-option value="maintain">
              <mat-icon>build</mat-icon>
              Bảo trì
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button
          mat-icon-button
          [matMenuTriggerFor]="roomMenu"
          matTooltip="Thêm tùy chọn"
        >
          <mat-icon>more_vert</mat-icon>
        </button>

        <mat-menu #roomMenu="matMenu">
          <button mat-menu-item>
            <mat-icon>edit</mat-icon>
            <span>Chỉnh sửa</span>
          </button>
          <button mat-menu-item>
            <mat-icon>visibility</mat-icon>
            <span>Xem chi tiết</span>
          </button>
          <button mat-menu-item>
            <mat-icon>delete</mat-icon>
            <span>Xóa</span>
          </button>
        </mat-menu>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Empty State -->
  <mat-card
    *ngIf="!isLoading && filteredRooms.length === 0"
    class="empty-state-card"
  >
    <mat-card-content>
      <div class="empty-state">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <h3>Không tìm thấy phòng nào</h3>
        <p>Thử thay đổi bộ lọc để xem thêm phòng</p>
        <button mat-raised-button color="primary" (click)="clearFilters()">
          <mat-icon>refresh</mat-icon>
          Đặt lại bộ lọc
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Floating Action Button -->
  <button
    mat-fab
    color="primary"
    class="fab-button"
    matTooltip="Thêm phòng mới"
  >
    <mat-icon>add</mat-icon>
  </button>
</div>
