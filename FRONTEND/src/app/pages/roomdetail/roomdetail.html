<div class="room-detail">
  <div mat-mat-dialog-title class="dialog-title">
    <button mat-icon-button aria-label="Close" title="Back" mat-dialog-close>
      <mat-icon>keyboard_arrow_left</mat-icon>
    </button>
    <h2>Room detail</h2>
  </div>

  <div class="content">
    <!-- /* thông tin phòng */ -->
    <div class="room-info">
      <!-- /* images */ -->
      <div class="gallery">
        <input
          type="file"
          #fileInput
          (change)="onFileSelected($event)"
          multiple
          accept="image/*"
          style="display: none"
        />

        <button
          class="upload-btn"
          type="button"
          mat-raised-button
          color="primary"
          (click)="fileInput.click()"
        >
          <mat-icon>cloud_upload</mat-icon>
          Upload
        </button>

        <div class="thumbnails" #scrollContainerThumbnails>
          <img
            *ngFor="let img of _roomDetail.urlRoomImages"
            [src]="img"
            alt="thumbnail"
            (click)="changeImage(img)"
            class="thumb"
          />

          <img
            *ngFor="let img of _addedImages"
            [src]="img.url"
            alt="thumbnail"
            (click)="changeImage(img.url)"
            class="thumb"
          />
        </div>
        <div class="main-image">
          <img [src]="_currentImage" alt="Ảnh chính" class="main-photo" />
          <mat-icon
            *ngIf="_roomDetail.urlRoomImages.length > 0"
            (click)="onDeleteImage()"
          >
            delete
          </mat-icon>
        </div>
      </div>

      <div class="info">
        <!-- /* info chủ trọ */ -->
        <div class="owner-building-info-container">
          <mat-card class="owner-building-info-card">
            <mat-card-header class="owner-building-info-card-header">
              <mat-card-title class="owner-building-info-card-title">
                <mat-icon>contacts</mat-icon>
                Owner-Building information
              </mat-card-title>
            </mat-card-header>

            <mat-card-content class="owner-building-info-card-content">
              <div class="owner-info">
                <div>
                  <span class="material-symbols-outlined"> person </span>
                  <span>{{_roomDetail.ownerFullName}}</span>
                </div>
                <div>
                  <span class="material-symbols-outlined"> call</span>
                  <span>{{_roomDetail.ownerPhoneNumber}}</span>
                </div>
              </div>

              <div class="building-info">
                <div>
                  <span class="material-symbols-outlined"> apartment </span>
                  <span>{{_roomDetail.buildingName}}</span>
                </div>

                <div>
                  <span class="material-symbols-outlined"> location_on </span>
                  <span>{{_roomDetail.buildingAddress}}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="room-info-container">
          <mat-card class="room-info-card">
            <mat-card-content class="room-info-card-content">
              <div class="room-info-part1">
                <!-- mã phòng -->
                <div>
                  <label for="roomCode">Room code</label>
                  <input
                    id="roomCode"
                    type="text"
                    placeholder="d"
                    [(ngModel)]="_roomDetail.roomNumber"
                  />
                </div>

                <!-- diện tích -->
                <div>
                  <label for="roomArea">Area</label>
                  <input
                    id="roomArea"
                    type="text"
                    placeholder="20m2"
                    [(ngModel)]="_roomDetail.area"
                  />
                </div>

                <!-- tiền -->
                <div>
                  <label for="roomPricePerMonth">Price per month</label>
                  <input
                    id="roomPricePerMonth"
                    type="text"
                    placeholder="13000000"
                    [(ngModel)]="_roomDetail.price"
                  />
                </div>

                <div>
                  <label for="roomMaxGuests">Max Guests</label>
                  <input
                    id="roomMaxGuests"
                    type="number"
                    placeholder="0"
                    [(ngModel)]="_roomDetail.maxGuests"
                  />
                </div>
              </div>

              <!-- description -->
              <div class="room-info-description">
                <label for="roomDescription">Description</label>
                <textarea
                  name="roomDescription"
                  id="roomDescription"
                  rows="3"
                  [(ngModel)]="_roomDetail.description"
                >
              <!-- Phòng có ma -->
                </textarea>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="members-container">
          <mat-card class="card members-card">
            <mat-card-header class="card-header members-header">
              <mat-card-title class="card-header-title members-title">
                <mat-icon>group</mat-icon>
                Members [
                {{_roomDetail?.members?.length}}/{{_roomDetail?.maxGuests}} ]
              </mat-card-title>
              <div class="add-container">
                <ng-container
                  *ngIf="_roomDetail?.members?.length === 0 && _deleteMembers.length === 0; else addContract"
                >
                  <button mat-button class="btn-add" (click)="onAddContract()">
                    <mat-icon>add</mat-icon>
                    Create contract
                  </button>
                </ng-container>

                <ng-template #addContract>
                  <mat-form-field appearance="outline" class="search-field">
                    <mat-label>Search to add</mat-label>
                    <input
                      matInput
                      placeholder="Member ID..."
                      #inputAddMemberID
                    />
                    <button
                      mat-icon-button
                      matSuffix
                      matTooltip="Add member"
                      (click)="onAddMember(inputAddMemberID.value)"
                    >
                      <mat-icon>add</mat-icon>
                    </button>
                  </mat-form-field>
                </ng-template>
              </div>
            </mat-card-header>

            <mat-card-content class="card-content members-content">
              <ng-container
                *ngIf="_roomDetail.members.length > 0; else noMembers"
              >
                <div
                  class="member"
                  *ngFor="let member of _roomDetail.members"
                  [class.memberIsSelected]="member.id === _selectedMember"
                  (click)="defSelectedMember(member.id)"
                >
                  <img [src]="member.urlAvatar" alt="" />
                  <div class="row-info-container">
                    <div class="row-info fullName">
                      <span class="material-symbols-outlined"> person </span>
                      <span>{{ member.fullName }}</span>
                    </div>
                    <div>
                      <div class="row-info phoneNumber">
                        <span class="material-symbols-outlined"> call</span>
                        <span> {{ member.phoneNumber }}</span>
                      </div>
                      <div class="row-info bdate">
                        <span class="material-symbols-outlined"> cake </span>
                        <span>{{ member.bdate | date: 'dd/MM/yyyy' }}</span>
                      </div>

                      <div class="row-info icon-actions">
                        <mat-icon (click)="onRemoveMember(member.id)">
                          delete
                        </mat-icon>
                        <mat-icon (click)="onViewMember(member.id)">
                          remove_red_eye
                        </mat-icon>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>

              <ng-template #noMembers>
                <div style="padding: 1rem; color: #888">No member</div>
              </ng-template>
            </mat-card-content>
          </mat-card>
        </div>

        <div class="assets-container">
          <mat-card class="assets-card">
            <mat-card-header class="assets-header">
              <mat-card-title class="assets-title">
                <mat-icon>inventory_2</mat-icon>
                Assets
              </mat-card-title>

              <div class="add-container">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Select Assets</mat-label>
                  <mat-select
                    [formControl]="selectedAssetsID"
                    multiple
                    placeholder="Choose your assets..."
                    panelClass="professional-panel"
                  >
                    <mat-option
                      *ngFor="let asset of _assetsData; trackBy: trackByAssetID"
                      [value]="asset.assetID"
                      (onSelectionChange)="onOptionChange($event, asset.assetID)"
                    >
                      {{ asset.name }}
                    </mat-option>
                  </mat-select>
                  <mat-hint>You can select multiple assets</mat-hint>
                </mat-form-field>
              </div>
            </mat-card-header>

            <mat-card-content class="assets-content">
              <!-- Empty state -->
              <ng-container *ngIf="getAssetData.length === 0; else assetsGrid">
                <div class="empty-state">
                  <mat-icon class="empty-icon">inventory_2</mat-icon>
                  <p>No assets in this room</p>
                </div>
              </ng-container>

              <!-- Assets grid -->
              <ng-template #assetsGrid>
                <div class="assets-container">
                  <!-- Grid layout -->
                  <div class="assets-grid">
                    <div *ngFor="let asset of getAssetData" class="asset-item">
                      <span class="asset-name">{{ asset.assetName }}</span>
                      <div>
                        <mat-icon
                          (click)="onSelectedAssetChangeQuantity(asset.assetID,-1)"
                        >
                          remove
                        </mat-icon>
                        <mat-chip class="quantity-chip">
                          <label>x{{ asset.quantity }}</label>
                        </mat-chip>
                        <mat-icon
                          (click)="onSelectedAssetChangeQuantity(asset.assetID,1)"
                        >
                          add
                        </mat-icon>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </div>
  </div>

  <div mat-mat-dialog-actions class="dialog-actions">
    <div class="btn-container">
      <button id="btnCancel" (click)="OnCancel()">Cancel</button>
      <button id="btnApply" (click)="onUpdateRoom()">Save</button>
    </div>
  </div>
</div>
